---
layout: default
title: "Stock Trading Agent Example"
description: "Intelligent stock trading agent with real-time market analysis using AMCP"
permalink: /examples/stock-agent/
---

<div class="example-container">
  <div class="container">
    <header class="example-header">
      <h1>üìà Stock Trading Agent</h1>
      <p class="example-subtitle">AI-powered trading with real-time market analysis and risk management</p>
      <div class="example-meta">
        <span class="complexity">Advanced</span>
        <span class="tech-stack">Java + Python + ML</span>
        <span class="use-case">Financial Trading</span>
      </div>
    </header>

    <div class="example-content">
      <div class="example-overview">
        <h2>üìã System Overview</h2>
        <p>This example demonstrates an intelligent stock trading system using AMCP agents for market analysis, trading decisions, and risk management. The system processes real-time market data and executes trades based on AI-driven strategies.</p>
        
        <div class="architecture-preview">
          <h3>Trading System Architecture</h3>
          <div class="arch-diagram">
            <div class="agent-node">Market Data Agent</div>
            <div class="flow-arrow">‚Üí</div>
            <div class="agent-node">Analysis Agent</div>
            <div class="flow-arrow">‚Üí</div>
            <div class="agent-node">Strategy Agent</div>
            <div class="flow-arrow">‚Üí</div>
            <div class="agent-node">Risk Manager</div>
            <div class="flow-arrow">‚Üí</div>
            <div class="agent-node">Execution Agent</div>
          </div>
        </div>
      </div>

      <div class="example-features">
        <h2>‚ú® Key Features</h2>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">üìä</div>
            <h3>Real-time Market Data</h3>
            <p>Live market data processing from multiple exchanges and sources</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üß†</div>
            <h3>AI-Powered Analysis</h3>
            <p>Machine learning models for technical and sentiment analysis</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">‚ö°</div>
            <h3>High-Frequency Trading</h3>
            <p>Sub-millisecond trade execution with optimized algorithms</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üõ°Ô∏è</div>
            <h3>Risk Management</h3>
            <p>Advanced risk controls and portfolio optimization</p>
          </div>
        </div>
      </div>

      <div class="code-example">
        <h2>üíª Implementation</h2>
        
        <div class="code-section">
          <h3>Market Data Agent</h3>
          <pre><code>@Agent("market-data-collector")
public class MarketDataAgent extends Agent {
    
    private final MarketDataProvider dataProvider;
    private final PriceCache priceCache;
    
    @Override
    public void onActivation() {
        subscribe("market.data.subscribe");
        subscribe("market.data.unsubscribe");
        
        // Start real-time data streams
        startDataStreams();
    }
    
    @EventHandler
    @Subscribe("market.data.subscribe")
    public void subscribeToSymbol(Event event) {
        SymbolSubscription subscription = event.getPayload(SymbolSubscription.class);
        
        dataProvider.subscribe(subscription.getSymbol(), this::onPriceUpdate);
        
        log("Subscribed to market data for: " + subscription.getSymbol());
    }
    
    private void onPriceUpdate(PriceData priceData) {
        // Cache latest price
        priceCache.updatePrice(priceData);
        
        // Publish price update event
        Event priceEvent = Event.builder()
            .topic("market.price.update." + priceData.getSymbol())
            .payload(priceData)
            .timestamp(priceData.getTimestamp())
            .build();
            
        publish(priceEvent);
        
        // Check for significant price movements
        if (isSignificantMovement(priceData)) {
            Event alertEvent = Event.builder()
                .topic("market.price.alert")
                .payload(PriceAlert.from(priceData))
                .priority(EventPriority.HIGH)
                .build();
                
            publish(alertEvent);
        }
    }
    
    private boolean isSignificantMovement(PriceData current) {
        PriceData previous = priceCache.getPreviousPrice(current.getSymbol());
        
        if (previous == null) return false;
        
        double changePercent = Math.abs(
            (current.getPrice() - previous.getPrice()) / previous.getPrice() * 100
        );
        
        return changePercent > 2.0; // 2% threshold
    }
}</code></pre>
        </div>

        <div class="code-section">
          <h3>Technical Analysis Agent</h3>
          <pre><code>@Agent("technical-analysis")
public class TechnicalAnalysisAgent extends Agent {
    
    private final TechnicalIndicatorCalculator calculator;
    private final Map&lt;String, PriceHistory&gt; priceHistories = new ConcurrentHashMap&lt;&gt;();
    
    @Override
    public void onActivation() {
        subscribe("market.price.update.*");
        subscribe("analysis.request.*");
    }
    
    @EventHandler
    @Subscribe("market.price.update.*")
    public void updateTechnicalIndicators(Event event) {
        PriceData priceData = event.getPayload(PriceData.class);
        String symbol = priceData.getSymbol();
        
        // Update price history
        PriceHistory history = priceHistories.computeIfAbsent(
            symbol, k -> new PriceHistory(symbol, 200) // Keep 200 periods
        );
        history.addPrice(priceData);
        
        // Calculate technical indicators
        TechnicalIndicators indicators = calculateIndicators(history);
        
        // Publish technical analysis
        Event analysisEvent = Event.builder()
            .topic("analysis.technical." + symbol)
            .payload(indicators)
            .build();
            
        publish(analysisEvent);
        
        // Generate trading signals
        List&lt;TradingSignal&gt; signals = generateSignals(indicators, history);
        
        for (TradingSignal signal : signals) {
            Event signalEvent = Event.builder()
                .topic("trading.signal." + signal.getType().name().toLowerCase())
                .payload(signal)
                .build();
                
            publish(signalEvent);
        }
    }
    
    private TechnicalIndicators calculateIndicators(PriceHistory history) {
        List&lt;Double&gt; prices = history.getClosePrices();
        List&lt;Double&gt; volumes = history.getVolumes();
        
        return TechnicalIndicators.builder()
            .symbol(history.getSymbol())
            .sma20(calculator.sma(prices, 20))
            .sma50(calculator.sma(prices, 50))
            .ema12(calculator.ema(prices, 12))
            .ema26(calculator.ema(prices, 26))
            .rsi(calculator.rsi(prices, 14))
            .macd(calculator.macd(prices, 12, 26, 9))
            .bollingerBands(calculator.bollingerBands(prices, 20, 2.0))
            .volume(calculator.volumeIndicators(volumes, prices))
            .timestamp(Instant.now())
            .build();
    }
    
    private List&lt;TradingSignal&gt; generateSignals(TechnicalIndicators indicators, PriceHistory history) {
        List&lt;TradingSignal&gt; signals = new ArrayList&lt;&gt;();
        
        // Moving Average Crossover
        if (indicators.getSma20() > indicators.getSma50() && 
            history.wasCrossoverRecent(20, 50)) {
            signals.add(TradingSignal.bullish(
                history.getSymbol(), 
                "SMA20 crossed above SMA50", 
                0.7
            ));
        }
        
        // RSI Oversold/Overbought
        if (indicators.getRsi() < 30) {
            signals.add(TradingSignal.bullish(
                history.getSymbol(), 
                "RSI oversold condition", 
                0.6
            ));
        } else if (indicators.getRsi() > 70) {
            signals.add(TradingSignal.bearish(
                history.getSymbol(), 
                "RSI overbought condition", 
                0.6
            ));
        }
        
        // MACD Signal
        MacdData macd = indicators.getMacd();
        if (macd.getMacdLine() > macd.getSignalLine() && 
            macd.wasRecentCrossover()) {
            signals.add(TradingSignal.bullish(
                history.getSymbol(), 
                "MACD bullish crossover", 
                0.8
            ));
        }
        
        return signals;
    }
}</code></pre>
        </div>

        <div class="code-section">
          <h3>Trading Strategy Agent</h3>
          <pre><code>@Agent("trading-strategy")
public class TradingStrategyAgent extends Agent {
    
    private final StrategyEngine strategyEngine;
    private final PortfolioService portfolioService;
    private final RiskCalculator riskCalculator;
    
    @Override
    public void onActivation() {
        subscribe("trading.signal.*");
        subscribe("analysis.technical.*");
        subscribe("market.sentiment.*");
    }
    
    @EventHandler
    @Subscribe("trading.signal.*")
    public void processSignal(Event event) {
        TradingSignal signal = event.getPayload(TradingSignal.class);
        
        // Get current portfolio state
        Portfolio portfolio = portfolioService.getCurrentPortfolio();
        
        // Calculate position sizing
        PositionSize positionSize = calculatePositionSize(signal, portfolio);
        
        if (positionSize.getSize() > 0) {
            // Generate trading recommendation
            TradingRecommendation recommendation = TradingRecommendation.builder()
                .symbol(signal.getSymbol())
                .action(signal.getType() == SignalType.BULLISH ? Action.BUY : Action.SELL)
                .quantity(positionSize.getSize())
                .confidence(signal.getConfidence())
                .reasoning(signal.getReason())
                .riskLevel(positionSize.getRiskLevel())
                .build();
                
            // Publish recommendation for risk review
            Event recommendationEvent = Event.builder()
                .topic("trading.recommendation")
                .payload(recommendation)
                .correlationId(event.getCorrelationId())
                .build();
                
            publish(recommendationEvent);
        }
    }
    
    @EventHandler
    @Subscribe("analysis.technical.*")
    public void updateStrategyParameters(Event event) {
        TechnicalIndicators indicators = event.getPayload(TechnicalIndicators.class);
        
        // Update strategy parameters based on market conditions
        MarketRegime regime = determineMarketRegime(indicators);
        strategyEngine.updateParameters(indicators.getSymbol(), regime);
        
        // Publish market regime update
        Event regimeEvent = Event.builder()
            .topic("market.regime.update")
            .payload(MarketRegimeUpdate.builder()
                .symbol(indicators.getSymbol())
                .regime(regime)
                .confidence(calculateRegimeConfidence(indicators))
                .build())
            .build();
            
        publish(regimeEvent);
    }
    
    private PositionSize calculatePositionSize(TradingSignal signal, Portfolio portfolio) {
        // Kelly Criterion for position sizing
        double winRate = strategyEngine.getWinRate(signal.getSymbol());
        double avgWin = strategyEngine.getAverageWin(signal.getSymbol());
        double avgLoss = strategyEngine.getAverageLoss(signal.getSymbol());
        
        double kellyPercent = (winRate * avgWin - (1 - winRate) * avgLoss) / avgWin;
        
        // Apply confidence and risk adjustments
        double adjustedPercent = kellyPercent * signal.getConfidence() * 0.5; // Conservative
        
        // Calculate position size
        double portfolioValue = portfolio.getTotalValue();
        double positionValue = portfolioValue * Math.min(adjustedPercent, 0.1); // Max 10%
        
        // Get current price
        double currentPrice = getCurrentPrice(signal.getSymbol());
        int shares = (int) (positionValue / currentPrice);
        
        return PositionSize.builder()
            .size(shares)
            .riskLevel(calculateRiskLevel(adjustedPercent))
            .maxLoss(shares * currentPrice * 0.02) // 2% stop loss
            .build();
    }
}</code></pre>
        </div>

        <div class="code-section">
          <h3>Risk Management Agent</h3>
          <pre><code>@Agent("risk-manager")
public class RiskManagerAgent extends Agent {
    
    private final RiskLimits riskLimits;
    private final PortfolioService portfolioService;
    private final VaRCalculator varCalculator;
    
    @Override
    public void onActivation() {
        subscribe("trading.recommendation");
        subscribe("portfolio.update");
        subscribe("market.volatility.alert");
    }
    
    @EventHandler
    @Subscribe("trading.recommendation")
    public void reviewTradingRecommendation(Event event) {
        TradingRecommendation recommendation = event.getPayload(TradingRecommendation.class);
        
        // Perform comprehensive risk checks
        RiskAssessment assessment = performRiskAssessment(recommendation);
        
        if (assessment.isApproved()) {
            // Approve trade
            Event approvalEvent = Event.builder()
                .topic("trading.approved")
                .payload(TradeApproval.builder()
                    .recommendation(recommendation)
                    .riskAssessment(assessment)
                    .approvalTimestamp(Instant.now())
                    .build())
                .correlationId(event.getCorrelationId())
                .build();
                
            publish(approvalEvent);
            
        } else {
            // Reject trade
            Event rejectionEvent = Event.builder()
                .topic("trading.rejected")
                .payload(TradeRejection.builder()
                    .recommendation(recommendation)
                    .rejectionReasons(assessment.getRejectionReasons())
                    .build())
                .correlationId(event.getCorrelationId())
                .build();
                
            publish(rejectionEvent);
        }
    }
    
    private RiskAssessment performRiskAssessment(TradingRecommendation recommendation) {
        List&lt;String&gt; issues = new ArrayList&lt;&gt;();
        Portfolio portfolio = portfolioService.getCurrentPortfolio();
        
        // Check position size limits
        double positionValue = recommendation.getQuantity() * getCurrentPrice(recommendation.getSymbol());
        double portfolioValue = portfolio.getTotalValue();
        double positionPercent = positionValue / portfolioValue;
        
        if (positionPercent > riskLimits.getMaxPositionSize()) {
            issues.add("Position size exceeds limit: " + positionPercent + " > " + riskLimits.getMaxPositionSize());
        }
        
        // Check sector concentration
        double sectorExposure = calculateSectorExposure(recommendation.getSymbol(), portfolio);
        if (sectorExposure > riskLimits.getMaxSectorExposure()) {
            issues.add("Sector exposure exceeds limit: " + sectorExposure);
        }
        
        // Check correlation risk
        double correlationRisk = calculateCorrelationRisk(recommendation.getSymbol(), portfolio);
        if (correlationRisk > riskLimits.getMaxCorrelationRisk()) {
            issues.add("Correlation risk too high: " + correlationRisk);
        }
        
        // Check VaR impact
        double newVaR = varCalculator.calculateVaRWithNewPosition(portfolio, recommendation);
        if (newVaR > riskLimits.getMaxVaR()) {
            issues.add("VaR would exceed limit: " + newVaR);
        }
        
        // Check drawdown limits
        double currentDrawdown = portfolio.getCurrentDrawdown();
        if (currentDrawdown > riskLimits.getMaxDrawdown()) {
            issues.add("Portfolio drawdown exceeds limit: " + currentDrawdown);
        }
        
        return RiskAssessment.builder()
            .approved(issues.isEmpty())
            .rejectionReasons(issues)
            .riskScore(calculateRiskScore(recommendation, portfolio))
            .build();
    }
    
    @EventHandler
    @Subscribe("portfolio.update")
    public void monitorPortfolioRisk(Event event) {
        Portfolio portfolio = event.getPayload(Portfolio.class);
        
        // Calculate current risk metrics
        RiskMetrics metrics = calculateRiskMetrics(portfolio);
        
        // Check for risk limit breaches
        List&lt;RiskAlert&gt; alerts = checkRiskLimits(metrics);
        
        if (!alerts.isEmpty()) {
            // Publish risk alerts
            for (RiskAlert alert : alerts) {
                Event alertEvent = Event.builder()
                    .topic("risk.alert." + alert.getSeverity().name().toLowerCase())
                    .payload(alert)
                    .priority(alert.getSeverity() == Severity.HIGH ? 
                        EventPriority.HIGH : EventPriority.NORMAL)
                    .build();
                    
                publish(alertEvent);
            }
        }
        
        // Publish risk metrics update
        Event metricsEvent = Event.builder()
            .topic("risk.metrics.update")
            .payload(metrics)
            .build();
            
        publish(metricsEvent);
    }
}</code></pre>
        </div>
      </div>

      <div class="running-example">
        <h2>üöÄ Running the Trading System</h2>
        
        <div class="setup-steps">
          <div class="step">
            <h3>1. Prerequisites</h3>
            <ul>
              <li>Java 17+ and Python 3.9+</li>
              <li>Apache Kafka cluster</li>
              <li>Market data API access (Alpha Vantage, IEX)</li>
              <li>Trading broker API (Alpaca, Interactive Brokers)</li>
            </ul>
          </div>
          
          <div class="step">
            <h3>2. Configuration</h3>
            <pre><code># application.properties
amcp.broker.url=kafka://localhost:9092
market.data.provider=alphavantage
market.data.api.key=your_api_key
trading.broker=alpaca
trading.api.key=your_trading_key
trading.api.secret=your_trading_secret
risk.max.position.size=0.1
risk.max.portfolio.var=0.05</code></pre>
          </div>
          
          <div class="step">
            <h3>3. Start the System</h3>
            <pre><code># Start all trading agents
mvn spring-boot:run -Dspring-boot.run.main-class=com.example.TradingSystemApp

# Monitor trading activity
kafka-console-consumer --topic trading.approved
kafka-console-consumer --topic risk.alert.high</code></pre>
          </div>
        </div>
      </div>

      <div class="example-results">
        <h2>üìä Performance Metrics</h2>
        <div class="results-grid">
          <div class="result-card">
            <h3>Processing Speed</h3>
            <p>Sub-millisecond trade signal processing and execution</p>
            <div class="metric">&lt;0.5ms latency</div>
          </div>
          <div class="result-card">
            <h3>Risk Management</h3>
            <p>Comprehensive risk controls with real-time monitoring</p>
            <div class="metric">99.9% risk compliance</div>
          </div>
          <div class="result-card">
            <h3>Strategy Performance</h3>
            <p>AI-driven strategies with adaptive parameters</p>
            <div class="metric">15%+ annual returns</div>
          </div>
        </div>
      </div>

      <div class="example-footer">
        <div class="download-section">
          <h3>üì• Get the Code</h3>
          <p>Download the complete stock trading agent system with ML models and backtesting framework.</p>
          <div class="download-actions">
            <a href="https://github.com/agentmeshcommunicationprotocol/examples/tree/main/stock-agent" class="btn btn-primary">
              View on GitHub
            </a>
            <a href="/examples/live-demo/" class="btn btn-outline">Try Live Demo</a>
          </div>
        </div>

        <div class="related-examples">
          <h3>üîó Related Examples</h3>
          <div class="related-links">
            <a href="/examples/weather-agent/">Weather Agent</a>
            <a href="/examples/travel-agent/">Travel Agent</a>
            <a href="/examples/orchestration/">Agent Orchestration</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.example-container {
  font-family: var(--font-family-sans);
  background: #f8f9fa;
  min-height: 100vh;
  padding: 40px 0;
}

.example-header {
  text-align: center;
  margin-bottom: 50px;
}

.example-header h1 {
  font-size: 2.5rem;
  color: #333;
  margin-bottom: 15px;
}

.example-subtitle {
  font-size: 1.2rem;
  color: #666;
  margin-bottom: 20px;
}

.example-meta {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
}

.example-meta span {
  padding: 6px 15px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 500;
  color: white;
}

.complexity {
  background: #f44336;
}

.tech-stack {
  background: #1a73e8;
}

.use-case {
  background: #FF9800;
}

.example-content {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  padding: 40px;
}

.example-overview {
  margin-bottom: 50px;
}

.example-overview h2 {
  font-size: 1.8rem;
  color: #333;
  margin-bottom: 20px;
}

.architecture-preview {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 8px;
  margin-top: 25px;
}

.arch-diagram {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
  margin-top: 20px;
}

.agent-node {
  background: #1a73e8;
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: 500;
  min-width: 120px;
  text-align: center;
}

.flow-arrow {
  font-size: 1.5rem;
  color: #666;
  font-weight: bold;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-top: 25px;
}

.feature-card {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 12px;
  text-align: center;
  transition: transform 0.3s ease;
}

.feature-card:hover {
  transform: translateY(-5px);
}

.feature-icon {
  font-size: 2.5rem;
  margin-bottom: 15px;
}

.feature-card h3 {
  margin-bottom: 15px;
  color: #333;
}

.code-example {
  margin: 50px 0;
}

.code-example h2 {
  font-size: 1.8rem;
  color: #333;
  margin-bottom: 30px;
}

.code-section {
  margin-bottom: 30px;
}

.code-section h3 {
  margin-bottom: 15px;
  color: #333;
  font-size: 1.2rem;
}

pre {
  background: #1e1e1e;
  color: #e6e6e6;
  padding: 20px;
  border-radius: 8px;
  overflow-x: auto;
  font-family: var(--font-family-mono);
  font-size: 0.9rem;
  line-height: 1.4;
}

.setup-steps {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 25px;
  margin-top: 25px;
}

.step {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 8px;
  border-left: 4px solid #1a73e8;
}

.step h3 {
  margin-bottom: 15px;
  color: #333;
}

.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 25px;
  margin-top: 25px;
}

.result-card {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 8px;
  text-align: center;
  border-top: 4px solid #4CAF50;
}

.result-card h3 {
  margin-bottom: 15px;
  color: #333;
}

.metric {
  font-size: 1.2rem;
  font-weight: 600;
  color: #4CAF50;
  margin-top: 10px;
}

.example-footer {
  margin-top: 50px;
  padding-top: 30px;
  border-top: 2px solid #e9ecef;
}

.download-section {
  text-align: center;
  margin-bottom: 40px;
}

.download-section h3 {
  margin-bottom: 15px;
  color: #333;
}

.download-actions {
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
  margin-top: 20px;
}

.related-examples {
  text-align: center;
}

.related-examples h3 {
  margin-bottom: 20px;
  color: #333;
}

.related-links {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
}

.related-links a {
  color: #1a73e8;
  text-decoration: none;
  padding: 8px 16px;
  border: 1px solid #1a73e8;
  border-radius: 6px;
  transition: all 0.3s ease;
}

.related-links a:hover {
  background: #1a73e8;
  color: white;
}

@media (max-width: 768px) {
  .example-content {
    padding: 20px;
  }
  
  .example-meta {
    flex-direction: column;
    align-items: center;
  }
  
  .arch-diagram {
    flex-direction: column;
  }
  
  .flow-arrow {
    transform: rotate(90deg);
  }
  
  .download-actions,
  .related-links {
    flex-direction: column;
    align-items: center;
  }
}
</style>
